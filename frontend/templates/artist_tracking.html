<!DOCTYPE html>
<html lang="en">
<head>
    <title>Tracking For Spotify</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#121313" />
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}" />

    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/artist_tracking.css') }}">
</head>

<!-- The panel on the right hand side of the screen, allowing the user to change between the different pages and also logout of their account  -->
<div class="side_panel" id="side_panel" onload="close_settings()">
    <div class="close_settings_button" onclick="close_settings()">&#9776;</div>
    <div class="current_user" title="Open Spotify Account" onclick="window.open('{{user['external_urls']['spotify']}}')">

    <!-- If the user has uploaded their own profile picture it will display it, otherwise it will show an empty user profile image of a head silhouette -->
    {% if user['images'][1]['url'] != "None": %}
        <img class="user_profile" src="{{user['images'][1]['url']}}"></img>
    {% else: %}
        <ion-icon class="user_profile" id="empty_profile" name="person-outline"></ion-icon>
    {% endif %}

    <!-- Checks if the user has a specified display name to show instead of their username where the display name can be any text, but username is unique to each user -->
    {% if "display_name" in user: %} 
        <div class="user_name">{{user["display_name"]}}</div>
    {% else: %}
        <div class="user_name">{{user["user_name"]}}</div>
    {% endif %}
    </div>

    <!-- Holds all the links to the other pages within the settings panel and will redirect to the new page when clicked on it. Will not reload the same page again -->
    <div class="page_locator_box">
        <div class="page_locator"  id="song_tracking" onclick="window.location.assign('/song-tracking');">Song Tracking</div>
        <div class="page_locator" id="artist_tracking">Artist Tracking</div>
        <div class="page_locator" id="genre_tracking" onclick="window.location.assign('/genre-tracking');">Genre Tracking</div>
        <div class="page_locator" id="tag_editor" onclick="window.location.assign('/tag-editor');">Tag Editor</div>
    </div>

    <button class="sign_out_button" onclick="sign_out()">Sign Out</button>
</div>

<!-- Empty canvas display for the artist tracking graph, initially invisible and once displayed can press the x button to close it -->
<div id="graph_holder"><div id="close_graph_button" onclick="close_graph()">x</div><canvas id="graph_canvas"></canvas></div>

<body>
    <header>
        <img class="spotify_logo" src="{{url_for('static', filename='imgs/logos/Spotify_Logo_RGB_Green.png')}}" onclick="open_spotify_website()" title="Open Spotify"></img>

        <button class="open_settings_button" onclick="open_settings()">&#9776;</button>
    </header>

    <div class="button_holder">
        <button class="time_selector" id="short_term" onclick="update_tracking(this)">Previous 4 Weeks</button>
        <button class="time_selector" id="medium_term" onclick="update_tracking(this)">Previous 6 Months</button>
        <button class="time_selector" id="long_term" onclick="update_tracking(this)">All Time</button>
    </div>

    <!-- Main grid which holds the artists, starts empty and is dynamically updated using "update_tracking()" -->
    <div id="table_body"></div>

    <footer>
        <!-- Displays the user's currently playing song, which is updated every 10 seconds using the function "get_currently_playing()" -->
        <div id="currently_playing_box" onload="get_currently_playing()">
            <img id="current_song_image" src=""></img>
            <div class="name_album_text_holder">
                <div id="current_song_name"></div>
                <div id="current_song_album"></div>
            </div>
        </div>

        <!-- Button which allows the users to apply their tags to their current playlist and filter it #not currently functional#  -->
        <div class="filter_queue">
            <ion-icon name="funnel-outline"></ion-icon>
        </div>
    </footer>
</body>
</html>

<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300&display=swap" rel="stylesheet">
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script type=text/javascript src="{{url_for('static', filename='js/main.js')}}"></script>  
<script type=text/javascript src="{{url_for('static', filename='js/artist_tracking.js')}}"></script> 